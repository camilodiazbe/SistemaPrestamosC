<!DOCTYPE html>
<html>
<head>
<title>Sistema de PrÃ©stamos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:Arial;
    background:#f4f4f4;
    padding:20px;
    margin:0;
}

h2{
    text-align:center;
}

.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}

.menu-left a{
    text-decoration:none;
    margin-right:10px;
}

.menu-btn{
    background:#2563eb;
    color:white;
    padding:8px 12px;
    border-radius:8px;
    border:none;
    cursor:pointer;
}

.logout-btn{
    background:#444;
    padding:8px 12px;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

.card{
    background:white;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
}

input, select{
    padding:8px;
    margin:5px 0;
    width:100%;
    box-sizing:border-box;
}

button{
    padding:10px 15px;
    background:black;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    width:100%;
}

.table-container{
    overflow-x:auto;
}

table{
    width:100%;
    background:white;
    border-radius:12px;
    margin-top:20px;
    border-collapse:collapse;
    font-size:13px;
    min-width:900px;
}

th,td{
    padding:8px;
    text-align:center;
    border-bottom:1px solid #ddd;
}

.activo{color:green;font-weight:bold}
.vencido{color:red;font-weight:bold}
.pagado{color:blue;font-weight:bold}

@media (min-width:768px){
    input, select{
        width:auto;
    }

    button{
        width:auto;
    }
}
</style>

<script>
function calcularPreview(){
    let monto = parseFloat(document.getElementById("monto").value) || 0;
    let interes = parseFloat(document.getElementById("interes").value) || 0;
    let total = monto + (monto * interes / 100);
    document.getElementById("preview").innerText = 
        "Total sin mora: $" + total.toFixed(2);
}
</script>
</head>
<body>

<div class="top-bar">

    <div class="menu-left">
        <a href="/estadisticas">
            <button class="menu-btn">ðŸ“Š EstadÃ­sticas</button>
        </a>
    </div>

    <div>
        <a href="/logout">
            <button class="logout-btn">Cerrar sesiÃ³n</button>
        </a>
    </div>

</div>

<h2>ðŸ’° Sistema de PrÃ©stamos Camilo Marrugo ðŸ’µ</h2>

<button onclick="window.location.href='/exportar_base_completa'">
    Descargar Base Completa en Excel
</button>
<a href="/reporte_excel">
<button style="background:green;margin-bottom:10px;">
ðŸ“Š Descargar Reporte Mensual
</button>
</a>

<a href="/exportar_todo">
<button style="background:blue;margin-bottom:20px;">
ðŸ“¥ Exportar Toda la Base
</button>
</a>



<div class="card">
<h3>Registrar PrÃ©stamo</h3>
<form method="POST" action="/agregar">
<input name="nombre" placeholder="Nombre completo" required>
<input name="cedula" placeholder="NÃºmero de cÃ©dula" required>
<input name="celular" placeholder="Celular" required>

<input id="monto" name="monto" type="number" placeholder="Monto" onkeyup="calcularPreview()" required>
<input id="interes" name="interes" type="number" placeholder="% InterÃ©s" onkeyup="calcularPreview()" required>

<input name="fecha_prestamo" type="date" required>
<input name="fecha_pago" type="date" required>

<input name="medio" placeholder="Nequi / Efectivo" required>
<input name="objeto" placeholder="Objeto en garantÃ­a" required>

<select name="tipo_prestamo" required>
    <option value="fijo">PrÃ©stamo con plazo</option>
    <option value="indefinido">PrÃ©stamo indefinido</option>
</select>

<input name="plazo_dias" type="number" placeholder="Plazo en dÃ­as (si es fijo)">

<p id="preview"></p>
<button type="submit">Registrar</button>
</form>
</div>

<div class="table-container">
<table>
<tr>
<th>Cliente</th>
<th>CÃ©dula</th>
<th>Celular</th>
<th>Tipo</th>
<th>Monto</th>
<th>%</th>
<th>Medio</th>
<th>GarantÃ­a</th>
<th>Fecha PrÃ©stamo</th>
<th>Fecha Pago</th>
<th>Mora</th>
<th>DÃ­as vencidos</th>
<th>Vence en</th>
<th>Total Deuda</th>
<th>Estado</th>
<th>Acciones</th>
</tr>

{% for p in prestamos %}
<tr>
<td>{{p.nombre}}</td>
<td>{{p.cedula}}</td>
<td>{{p.celular}}</td>
<td>{{p.tipo_prestamo}}</td>
<td>${{p.monto}}</td>
<td>{{p.interes}}%</td>
<td>{{p.medio}}</td>
<td>{{p.objeto}}</td>
<td>{{p.fecha_prestamo}}</td>
<td>{{p.fecha_pago}}</td>
<td>${{p.mora}}</td>
<td>{{p.dias}}</td>

<td>
{% if p.dias_restantes == "âˆž" %}
âˆž
{% elif p.pagado == 1 %}
â€”
{% elif p.dias_restantes > 0 %}
{{p.dias_restantes}} dÃ­as
{% else %}
0 dÃ­as
{% endif %}
</td>

<td><strong>${{p.total}}</strong></td>

<td>
{% if p.pagado == 1 %}
<span class="pagado">Pagado</span>
{% elif p.dias > 0 %}
<span class="vencido">Vencido</span>
{% else %}
<span class="activo">Activo</span>
{% endif %}
</td>

<td>

{% if p.pagado == 0 %}

{% if p.tipo_prestamo == "indefinido" %}
<br>
<a href="/mes_pagado/{{p.id}}">
<button style="background:green;margin-top:5px;">
Mes Pagado
</button>
</a>
{% endif %}

<form method="POST" action="/abonar/{{p.id}}">
<input name="abono" type="number" placeholder="Abono" required>
<button type="submit">Abonar</button>
</form>

<br>

<a href="/pagar/{{p.id}}">
<button>Pagar Total</button>
</a>


{% endif %}

<br>

<a href="/eliminar/{{p.id}}">
<button style="background:red;margin-top:5px;">Eliminar</button>
</a>

</td>

</tr>
{% endfor %}

</table>
</div>

</body>
</html>
